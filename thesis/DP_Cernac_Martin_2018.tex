% hidelinks remove colour boxes around hyperlinks
\documentclass[thesis=M,czech]{FITthesis}[2012/10/20]

\usepackage[utf8]{inputenc} % LaTeX source encoded as UTF-8
\usepackage{graphicx} %graphics files inclusion
\usepackage{amsmath} %advanced maths
\usepackage{amssymb} %additional math symbols
\usepackage{dirtree}
\usepackage{pdfpages}

% % list of acronyms
% \usepackage[acronym,nonumberlist,toc,numberedsection=autolabel]{glossaries}
% \iflanguage{czech}{\renewcommand*{\acronymname}{Seznam pou{\v z}it{\' y}ch zkratek}}{}
% \makeglossaries

\department{Katedra počítačových systémů}
\title{Komunikace skrze Captive portal}
\authorGN{Martin} %(křestní) jméno (jména) autora
\authorFN{Černáč} %příjmení autora
\authorWithDegrees{Bc. Martin Černáč} %jméno autora včetně akademických titulů
\author{Martin Černáč} %jméno autora bez akademických titulů
\supervisor{Ing. Aleš Padrta, Ph. D.}
\acknowledgements{Rád bych poděkoval svému vedoucímu za cenné rady, věcné připomínky a vstřícnost při konzultacích.}
\abstractCS{TODO V~několika větách shrňte obsah a přínos této práce v~češtině. Po přečtení abstraktu by měl mít čtenář dost informací pro rozhodnutí, zda chce Vaši práci číst.}
\abstractEN{TODO Sem doplňte ekvivalent abstraktu Vaší práce v~angličtině.}
\placeForDeclarationOfAuthenticity{V~Praze}
\declarationOfAuthenticityOption{4} %volba Prohlášení
\keywordsCS{Závěrečná práce, \LaTeX{}.}
\keywordsEN{Thesis, \LaTeX{}.}
\website{https://github.com/octaroot/CTU-FIT-MasterThesis} %volitelná URL práce, objeví se v tiráži


%dobre zdroje
%https://www.secplicity.org/2016/08/26/lessons-defcon-2016-bypassing-captive-portals/
%https://en.wikipedia.org/wiki/Captive_portal
%https://www.ietf.org/mail-archive/web/captive-portals/current/threads.html#00090

%seznam sw reseni
%https://mohammadthalif.wordpress.com/2010/12/14/list-of-open-source-captive-portal-software-and-network-access-control-nac/

%jak captive skodi a jak to delat nejlepe
%https://www.eff.org/deeplinks/2017/08/how-captive-portals-interfere-wireless-security-and-privacy

%ukazkova byznys stranka, ktera vychvaluje svuj captive sw ... lol
%prvni argument je uplne mimo, na podvrzene HTML strance neni nic legitniho, uplna blbost
%treti argument zminuje tracking uzivatele diky vynuceni loginu skrze socialni site, nebo email (chapu to tak, ze tam proste dam adresu a pusti me dal)
%https://www.securedgenetworks.com/blog/why-is-a-captive-portal-important-for-wireless-guest-access

\begin{document}

\begin{introduction}
Bezdrátové sítě se staly zcela běžným prostředkem mezilidské komunikace. Účastníci bezdrátové sítě mají možnost vyměňovat si navzájem informace a nebýt přitom omezeni kabelovým spojením. Pozitivním důsledkem je tedy zvýšená mobilita účastníků. Ta vedla k vlně popularity mobilních telefonů, využívajících bezdrátovou síť \textit{GSM}.

S rostoucími nároky uživatelů prošly běžně dostupné bezdrátové sítě rozsáhlým vývojem (vyšší prostupnost, nižší latence a další aspekty). Mezi dlouhodobě populární a rozšířené typy bezdrátových sítí se řadí technologie \textit{Wi-Fi}. Jedná se o technologii podporovanou širokým spektrem spotřební elektroniky (například televizory, tiskárny, mobilní telefony nebo počítače). Provozování \textit{Wi-Fi} sítě je díky bezlicenčnímu pásmu \textit{ISM} snadné a na trhu je dostupná celá řada produktů, zajišťující provoz takové sítě.

Z těchto důvodů došlo k velkému rozmachu takzvaných \textit{hotspotů}, tedy veřejně přístupných míst s pokrytím \textit{Wi-Fi} sítě. Taková Wi-Fi síť je zpravidla snadno přístupná a účastníkům nabízí přístup do sítě Internet. Ačkoliv je velice snadné začít s provozem \textit{hotspotu}, je nutné dbát na další aspekty provozu takové služby -- zejména právní aspekty.

Účastníci \textit{hotspotu} by měli být srozuměni s pravidly používání konkrétní sítě, limitovanou odpovědností provozovatele a před začátkem užívání sítě doložit svůj souhlas s pravidly. Provozovatel navíc může mít zájem o některé informace o uživatelích \textit{hotspotu}, případně po jisté době používání službu zpoplatnit.

Technologie \textit{Wi-Fi} však sama o sobě neumožňuje nic z výše uvedeného. Takovou situaci lze vyřešit například zapojením recepce v prostředí hotelu (uživatel písemně vyjádří souhlas s pravidly používání sítě, recepční vydá přístupové údaje do sítě). Častěji se však setkáváme s automatizovaným přístupem, realizovaným pomocí \textit{captive portálu} (z angličtiny \textit{Captive portal}).

Řešení s pomocí \textit{captive portálu} spočívá v detekci nově připojeného účastníka, informování o pravidlech provoz sítě a výzvu k jejich odsouhlasení účastníkem. Všechny následné interakce účastníka se sítí \textit{captive portál} ignoruje a nezasahuje do nich.

Z principu věci musí být \textit{captive portál} schopen \textbf{nejprve zasahovat do veškerého síťového provozu} (účastník doposud nedoložil souhlas s pravidly, neměl by mít možnost síť využívat) a \textbf{následně do provozu konkrétního účastníka nezasahovat vůbec}. Existuje celá řada technologických postupů pro docílení popsaného efektu. Mnohé z nich jsou však neefektivní a spoléhají na součinnost účastníka.

Právě proto jsem se rozhodl vypracovat diplomovou práci na téma obcházení \textit{captive portálu}, zdůrazňující jejich technologickou nedokonalost a poukázat na lepší řešení řízení síťového přístupu (\textit{Network Access Control}).

V této práci se proto budu zabývat popisem problematiky \textit{captive portálů} a obecnými způsoby jejich obcházení. Jako demonstraci technologické nedokonalosti užití \textit{captive portálu} pro zajištění řízení síťového přístupu rovněž navrhnu a implementuji protokol s důrazem na maximální prostupnost. Implementovaný protokol otestuji a provedu srovnání s dostupnými nástroji pro obcházení \textit{captive portálů}.
\end{introduction}

\chapter{Analýza současné situace}

Tato kapitola se věnuje problematice \textit{captive portálů}, motivací jejich nasazení v síti a častými problémy s používáním \textit{captive portálu} jako nástroje pro zajištění řízení síťového přístupu.

\section{Captive portál}

\textit{Captive portál} představuje webovou aplikaci, často nasazovanou na veřejně přístupných sítích. Aplikace má za úkol informovat nově připojené klienty o podmínkách užití sítě a požadovat uživatelův souhlas s jejich dodržováním. Až do momentu souhlasu s podmínkami užití sítě je uživateli odepřen přístup do zbytku sítě. Z toho plyne první část názvu \textit{\textbf{Captive} portál} -- uživatel je \uv{zajatý}, \uv{uvězněný} (v angličtině \textit{captive}).

\subsection{Motivace nasazení}

% proc to mame. legislativa provozu hotspotu. lidi odslouhlasi podminky sluzby, kryju se tim ja jako provozovatel -- nabizim jim sluzbu, ktera neni sofrovana.
% captive portal na dedikovane guest wifina: oddeleni guest trafficu, snazsi omezeni sirky pasma, data collection -- jaci lide se pripojuji na muj hotspot ... muzu napriklad nabidnou prihlaseni pres FB/jinou soc. sit.

\textit{Captive portál} je do provozu sítě často nasazován jako nástroj pro zajištění řízení síťového přístupu. Přístup do sítě je umožněn pouze klientům, kteří splní podmínky přístupu do sítě. Takovou podmínkou může být pouhé vyjádření souhlasu s používáním konkrétní sítě, nebo se může jednat o podmínku složitější, například:

\begin{itemize}
 \item shlédnutí reklamního spotu dle výběru provozovatele
 \item uhrazení poplatku pro přístup do sítě
 \item poskytnutí některých osobních údajů a souhlasu s jejich zpracováním
 \item doložení oprávnění pro přístup do sítě (kód z účtenky, číslo hotelového pokoje, \ldots)
 \item zviditelnění provozovatele pomocí sociálních médií (například Facebook \textit{check-in})
\end{itemize}

Jak plyne z výše uvedeného výčtu, vyjma právních aspektů může být \textit{captive portál} použit i pro shromažďování údajů o uživatelích sítě. Vhodným nástrojem pro takovou aktivitu je preferování \uv{přihlášení se} do \textit{captive portálu} pomocí uživatelova účtu na některé ze sociálních sítí. Webová aplikace (\textit{captive portál}) si od sociální sítě vyžádá informace jako například jméno, fotografii, pohlaví nebo datum narození uživatele. Provozovatel tedy může uživatele identifikovat, detekovat opakované návštěvy \textit{hotspotu} a (umožní-li mu to uživatel) nakládat se zaznamenanou aktivitou uživatele v síti. Na oplátku je uživateli \uv{zdarma} poskytnut přístup do sítě Internet.


%TODO pridat citaci a mozna obrazek
Společnost Facebook provozuje službu \textit{Facebook Wi-Fi}, cílenou na majitele obchodů. Jedná se o řešení na bázi \textit{captive portálu}, které vyžaduje aby uživatel sítě měl konto na sociální síti Facebook. Po připojení uživatele do sítě je uživatel vyzván ke sdílení informace o návštěvě obchodu, jehož \textit{hotspot} právě používá.

Poněkud méně invazivní motivací pro zavedení \textit{captive portálu} je prodej reklamního místa -- uživatel po připojení do sítě musí shlédnou reklamní spot, nebo vyplnit krátkou anketu. Provozovatel \textit{hotspotu} získá z takové aktivity finanční odměnu a protislužbou uživateli je přístup do sítě Internet.

Alternativně uživatel může doložit své oprávnění pro přístup do sítě. Například jednorázový kód z účtenky, čímž dokládá útratu v podniku, který \textit{hotspot} provozuje. Nebo číslo hotelového pokoje, čímž dokládá svůj pobyt v hotelu, který zahrnuje (jinak zpoplatněný) přístup do sítě Internet.



\subsection{Realizační technologie}

% jak captive portal funguje.
% jak je mozne ho realizovat (DNS/L3 ICMP/preklad *:80 na muj server -- casto zarizeni po pripojeni zkusi nacist nejakou well-known URL ktera by mela vratit HTTP 204)

\subsection{Technické problémy}

% https
% transaprency logs ??
% technicke problemy. je potreba prohlizec
%    ten ale spousta zarizeni proste nema (herni konzole Nintendo DS napr) -- resi se to \texttt{WISPr}-
% User je casto identifikovan pouze MAC/IP kombem -> sniff -> spoof.
% casto podvrhavane certifikaty, aby bylo mozne dostat uzivatle na loginpage.
% MITM! jak takove siti mohu verit ??

% obcas captive portal blokuje moc a OS nechape, ze je za captivem
% tzn neotevre se normalni OS-native popup (nejaky prohlizec bez session)
% ale clovek to musi udelat v normalnim prohlizeci .. possible data leaks

% jak captive detekuje chrome-os/chromium
% https://www.chromium.org/chromium-os/chromiumos-design-docs/network-portal-detection

\subsection{Netechnické problémy}

% podvrzene ssl certy uci uzivatele klikat na ``ano, ano, verim vsemu, hlavne at jede FB''.
%
% Nutnost splneni podminek pro pristup - napr. zadat email, pravdepodobne za ucelem SPAMovani.
% Nekdy je nutne i shlednout videoreklamu ala youtube/iprima.
% nekdy i vice invazivni a otravne veci
% o tom uz jsem psal, tak jen strucne

\subsection{Alternativy captive portálů}

% jak se to da delat jinak - 802.1x kdyz uz mame ucty .. wifi treba v kavarne kdyz si neco dam, to si umim predstavit.
% eduroam !! funguje naprosto v pohode! stejne vetsina captive protalu ma nekde v pozadi RADIUS
% negativa - ne kazdy klient to podporuje .. ale je 2018, takovych uz neni mnoho

% kdyz to nejde jinak, tak jak alespon lepe -- viz EFF article v sources/
%   -- napr neblokovat detekci captive portalu (HTTP 204 responses obvykle (No Content) -- protoze pak OS vetsinou nabidne nejaky osekany browser, ve kterem se otevre login form, coz snizuje pst. nejakeho leaku dat.


\section{Metody pro obcházení captive portálů}

% alfa-omega - pro pristup ke captive portalu musim byt validnim ucatnikem site
% tj musi fungovat DHCP (musim mit IP, musim zant GW), musi ``fungovat`` DNS
% to je problem zejo, kdyz uz na siti jsem je mnohem tezsi snazit se me nejak omezit
%
% jak se to da obejit.
% DNS tunely    DNSX, iodine (Ip Over DNS - atomic(I)=53 .. haha asociace)
% ICMP tunely   ICMPX
% VoIP SIP porty obcas otevrene
% web caching proxy 3128.
% mozna dokonce SSH 22?

% cilem prace je vyuzit co nejvic technik a delat MUX trafficu



% SSH spojeni, MUX (parsuje TCP stream a prenasi jen data po TCP(via SSH tunel)
% pro muj ucel nepouzitelne, ale zajiamve
% https://github.com/apenwarr/sshuttle


% pokud budu diskutovat kmitocty ISM pasma, ČTÚ ma na webu hezky popsany smernice odkud co a proc je bezlicencni atd.


\chapter{Návrh řešení}

Doplňte vhodný text.

\chapter{Implementace}

Doplňte vhodný text.

\chapter{Testování}

Doplňte vhodný text.


\begin{conclusion}
	Doplňte závěr.
	
\end{conclusion}

\bibliographystyle{csn690}
\bibliography{literatura}

\appendix

\chapter{Seznam použitých zkratek}
% \printglossaries



%TODO sort a-z
\begin{description}
	\item[DNS] Domain Name System
	\item[ICMP] Internet Control Message Protocol
	\item[XML] Extensible markup language
	\item[ISM] Industrial, Scientific and Medical radio bands -- kmitočty pro použití v průmyslu, vědě a medicíně
	\item[NAC] Network Access Control -- řízení síťového přístupu
	\item[GSM] Global System for Mobile Communications -- Globální Systém pro Mobilní komunikaci
\end{description}


% LaTeX notes:

% citace: viz \cite{kobltypo}

% vlna

% \begin{figure}\centering
% 	\includegraphics[width=0.5\textwidth, angle=30]{cvut-logo-bw}
% 	\caption[Příklad obrázku]{Ukázkový obrázek v~plovoucím prostředí}\label{fig:float}
% \end{figure}

%Může se hodit mít více verzí stejného obrázku, např. pro barevný či černobílý tisk a nebo pro prezentaci.

% label -> (viz obr. \ref{fig:gnuplot-bw}) 

% \subsection{Tabulky}
% 
% Tabulky lze zadávat různě, např. v~prostředí \verb|tabular|, avšak pro jejich vkládání platí to samé, co pro obrázky -- použijte plovoucí prostředí, v~tomto případě \verb|table|. Například tabulka \ref{tab:matematika} byla vložena tímto způsobem.
% 
% \begin{table}\centering
% 	\caption[Příklad tabulky]{Zadávání matematiky}\label{tab:matematika}
% 	\begin{tabular}{|l|l|c|c|}\hline
% 		Typ		& Prostředí		& \LaTeX{}ovská zkratka	& \TeX{}ovská zkratka	\tabularnewline \hline \hline
% 		Text		& \verb|math|		& \verb|\(...\)|	& \verb|$...$|		\tabularnewline \hline
% 		Displayed	& \verb|displaymath|	& \verb|\[...\]|	& \verb|$$...$$|	\tabularnewline \hline
% 	\end{tabular}
% \end{table}


% vkládání URL a podobných informací url{} ze stejnojmenného balíčku. Zajistíte tím jednak odlišení adresy od ostatního textu pomocí jiného písma a také zalamování na konci řádku.
% Chcete-li vkládat odkazy (funkční v~PDF), použijte příkaz \verb|href| z~balíčku \verb|hyperref|.

% % % % % % % % % % % % % % % % % % % % % % % % % % % 

\chapter{Obsah přiloženého CD}


% Vhodným způsobem vizualizujte obsah přiloženého média. Lze použít balíček \verb|dirtree| a vytvořit např. následující výstup (adresáře src a text s~příslušným obsahem jsou \emph{povinné}):
% 
% \begin{figure}
% 	\dirtree{%
% 		.1 readme.txt\DTcomment{stručný popis obsahu CD}.
% 		.1 exe\DTcomment{adresář se spustitelnou formou implementace}.
% 		.1 src.
% 		.2 impl\DTcomment{zdrojové kódy implementace}.
% 		.2 thesis\DTcomment{zdrojová forma práce ve formátu \LaTeX{}}.
% 		.1 text\DTcomment{text práce}.
% 		.2 thesis.pdf\DTcomment{text práce ve formátu PDF}.
% 	}
% \end{figure}


\end{document}
